"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[210],{9700:(s,n,a)=>{a.r(n),a.d(n,{data:()=>e});const e={key:"v-b2f49142",path:"/developing/network/join-testnet.html",title:"Joining Testnet",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"Install Dependencies",slug:"install-dependencies",children:[]},{level:2,title:"Install Osmosis Binary",slug:"install-osmosis-binary",children:[]},{level:2,title:"Initialize Osmosis Node",slug:"initialize-osmosis-node",children:[]},{level:2,title:"Set Up Cosmovisor",slug:"set-up-cosmovisor",children:[]},{level:2,title:"Set Up Osmosis Service",slug:"set-up-osmosis-service",children:[]},{level:2,title:"Start Osmosis Service",slug:"start-osmosis-service",children:[]}],filePathRelative:"developing/network/join-testnet.md",git:{updatedTime:1637704984e3,contributors:[{name:"Adam Tucker",email:"adamleetucker@outlook.com",commits:1}]}}},2249:(s,n,a)=>{a.r(n),a.d(n,{default:()=>o});const e=(0,a(6252).uE)('<h1 id="joining-testnet" tabindex="-1"><a class="header-anchor" href="#joining-testnet" aria-hidden="true">#</a> Joining Testnet</h1><h2 id="install-dependencies" tabindex="-1"><a class="header-anchor" href="#install-dependencies" aria-hidden="true">#</a> Install Dependencies</h2><p>Start by ensuring your system is up to date:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">sudo apt update</span></span>\n<span class="line"><span style="color:#ADBAC7;">sudo apt upgrade</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Install tools if not already installed (gcc, make, etc.):</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">sudo apt install git build-essential ufw curl jq snapd --yes</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Install go:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">wget -q -O - https://git.io/vQhTU </span><span style="color:#F47067;">|</span><span style="color:#ADBAC7;"> bash -s -- --version 1.17.2</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>After installed, open new terminal to properly load go</p><h2 id="install-osmosis-binary" tabindex="-1"><a class="header-anchor" href="#install-osmosis-binary" aria-hidden="true">#</a> Install Osmosis Binary</h2><p>Clone the osmosis repo, checkout and install v3.2.0_with_cache:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#6CB6FF;">cd</span><span style="color:#ADBAC7;"> $HOME</span></span>\n<span class="line"><span style="color:#ADBAC7;">git clone https://github.com/osmosis-labs/osmosis</span></span>\n<span class="line"><span style="color:#6CB6FF;">cd</span><span style="color:#ADBAC7;"> osmosis</span></span>\n<span class="line"><span style="color:#ADBAC7;">git checkout v3.2.0_with_cache</span></span>\n<span class="line"><span style="color:#ADBAC7;">make install</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="initialize-osmosis-node" tabindex="-1"><a class="header-anchor" href="#initialize-osmosis-node" aria-hidden="true">#</a> Initialize Osmosis Node</h2><p>You have now installed the Osmosis Daemon (osmosisd). Use osmosisd to initialize your node (replace the NODE_NAME with a name of your choosing):</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">osmosisd init NODE_NAME --chain-id=osmosis-testnet-0</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>We now need to open the config.toml to edit the seed list:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#6CB6FF;">cd</span><span style="color:#ADBAC7;"> $HOME/.osmosisd/config</span></span>\n<span class="line"><span style="color:#ADBAC7;">nano config.toml</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Use page down or arrow keys to get to the line that says seeds = &quot;&quot; and replace it with the following:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">seeds = </span><span style="color:#96D0FF;">&quot;4eaed17781cd948149098d55f80a28232a365236@testmosis.blockpane.com:26656&quot;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Then pres Ctrl+O, then enter to save, then Ctrl+X to exit</p><h2 id="set-up-cosmovisor" tabindex="-1"><a class="header-anchor" href="#set-up-cosmovisor" aria-hidden="true">#</a> Set Up Cosmovisor</h2><p>We will now set up cosmovisor to ensure the upgrade happens flawlessly. To install Cosmovisor:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#6CB6FF;">cd</span><span style="color:#ADBAC7;"> $HOME</span></span>\n<span class="line"><span style="color:#ADBAC7;">git clone https://github.com/cosmos/cosmos-sdk</span></span>\n<span class="line"><span style="color:#6CB6FF;">cd</span><span style="color:#ADBAC7;"> cosmos-sdk</span></span>\n<span class="line"><span style="color:#ADBAC7;">git checkout v0.42.9</span></span>\n<span class="line"><span style="color:#ADBAC7;">make cosmovisor</span></span>\n<span class="line"><span style="color:#ADBAC7;">cp cosmovisor/cosmovisor $GOPATH/bin/cosmovisor</span></span>\n<span class="line"><span style="color:#6CB6FF;">cd</span><span style="color:#ADBAC7;"> $HOME</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Create the required directories:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">mkdir -p </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.osmosisd/cosmovisor</span></span>\n<span class="line"><span style="color:#ADBAC7;">mkdir -p </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.osmosisd/cosmovisor/genesis</span></span>\n<span class="line"><span style="color:#ADBAC7;">mkdir -p </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.osmosisd/cosmovisor/genesis/bin</span></span>\n<span class="line"><span style="color:#ADBAC7;">mkdir -p </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.osmosisd/cosmovisor/upgrades</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Set the environment variables:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#6CB6FF;">echo</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;# Setup Cosmovisor&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.profile</span></span>\n<span class="line"><span style="color:#6CB6FF;">echo</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;export DAEMON_NAME=osmosisd&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.profile</span></span>\n<span class="line"><span style="color:#6CB6FF;">echo</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;export DAEMON_HOME=</span><span style="color:#ADBAC7;">$HOME</span><span style="color:#96D0FF;">/.osmosisd&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.profile</span></span>\n<span class="line"><span style="color:#6CB6FF;">echo</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;export DAEMON_ALLOW_DOWNLOAD_BINARIES=false&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.profile</span></span>\n<span class="line"><span style="color:#6CB6FF;">echo</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;export DAEMON_LOG_BUFFER_SIZE=512&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.profile</span></span>\n<span class="line"><span style="color:#6CB6FF;">echo</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;export DAEMON_RESTART_AFTER_UPGRADE=true&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.profile</span></span>\n<span class="line"><span style="color:#6CB6FF;">source</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.profile</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Download and replace the genesis file:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#6CB6FF;">cd</span><span style="color:#ADBAC7;"> $HOME/.osmosisd/config</span></span>\n<span class="line"><span style="color:#ADBAC7;">wget https://github.com/osmosis-labs/networks/raw/unity/v4/osmosis-1/upgrades/v4/testnet/genesis.tar.bz2</span></span>\n<span class="line"><span style="color:#ADBAC7;">tar -xjf genesis.tar.bz2</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Copy the current osmosisd binary into the cosmovisor/genesis folder:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">cp $GOPATH/bin/osmosisd </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.osmosisd/cosmovisor/genesis/bin</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>To check your work, ensure the version of cosmovisor and osmosisd are the same:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">cosmovisor version</span></span>\n<span class="line"><span style="color:#ADBAC7;">osmosisd version</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>These two command should both output 3.1.0-23-g517562d</p><p>Before we start cosmovisor, lets prep the upgrade to v4.0.0-rc1:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">mkdir -p </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.osmosisd/cosmovisor/upgrades/v4/bin</span></span>\n<span class="line"><span style="color:#6CB6FF;">cd</span><span style="color:#ADBAC7;"> $HOME/osmosis</span></span>\n<span class="line"><span style="color:#ADBAC7;">git checkout v4.0.0-rc1</span></span>\n<span class="line"><span style="color:#ADBAC7;">make build</span></span>\n<span class="line"><span style="color:#ADBAC7;">cp build/osmosisd </span><span style="color:#F47067;">~</span><span style="color:#ADBAC7;">/.osmosisd/cosmovisor/upgrades/v4/bin</span></span>\n<span class="line"><span style="color:#6CB6FF;">cd</span><span style="color:#ADBAC7;"> $HOME</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Reset private validator file to genesis state:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">osmosisd unsafe-reset-all</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="set-up-osmosis-service" tabindex="-1"><a class="header-anchor" href="#set-up-osmosis-service" aria-hidden="true">#</a> Set Up Osmosis Service</h2><p>While we could start cosmovisor now with &quot;cosmovisor start&quot;, lets set up a service to allow cosmovisor to run in the background as well as restart automatically if it runs into any problems:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#6CB6FF;">echo</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;[Unit]</span></span>\n<span class="line"><span style="color:#96D0FF;">Description=Cosmovisor daemon</span></span>\n<span class="line"><span style="color:#96D0FF;">After=network-online.target</span></span>\n<span class="line"><span style="color:#96D0FF;">[Service]</span></span>\n<span class="line"><span style="color:#96D0FF;">Environment=&quot;</span><span style="color:#ADBAC7;">DAEMON_NAME=osmosisd</span><span style="color:#96D0FF;">&quot;</span></span>\n<span class="line"><span style="color:#96D0FF;">Environment=&quot;</span><span style="color:#ADBAC7;">DAEMON_HOME=${HOME}/.osmosisd</span><span style="color:#96D0FF;">&quot;</span></span>\n<span class="line"><span style="color:#96D0FF;">Environment=&quot;</span><span style="color:#ADBAC7;">DAEMON_RESTART_AFTER_UPGRADE=true</span><span style="color:#96D0FF;">&quot;</span></span>\n<span class="line"><span style="color:#96D0FF;">Environment=&quot;</span><span style="color:#ADBAC7;">DAEMON_ALLOW_DOWNLOAD_BINARIES=false</span><span style="color:#96D0FF;">&quot;</span></span>\n<span class="line"><span style="color:#96D0FF;">Environment=&quot;</span><span style="color:#ADBAC7;">DAEMON_LOG_BUFFER_SIZE=512</span><span style="color:#96D0FF;">&quot;</span></span>\n<span class="line"><span style="color:#96D0FF;">User=</span><span style="color:#ADBAC7;">$USER</span></span>\n<span class="line"><span style="color:#96D0FF;">ExecStart=</span><span style="color:#ADBAC7;">${HOME}</span><span style="color:#96D0FF;">/go/bin/cosmovisor start</span></span>\n<span class="line"><span style="color:#96D0FF;">Restart=always</span></span>\n<span class="line"><span style="color:#96D0FF;">RestartSec=3</span></span>\n<span class="line"><span style="color:#96D0FF;">LimitNOFILE=4096</span></span>\n<span class="line"><span style="color:#96D0FF;">[Install]</span></span>\n<span class="line"><span style="color:#96D0FF;">WantedBy=multi-user.target</span></span>\n<span class="line"><span style="color:#96D0FF;">&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;</span><span style="color:#ADBAC7;">cosmovisor.service</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Move this new file to the systemd directory:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">sudo mv cosmovisor.service /lib/systemd/system/cosmovisor.service</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="start-osmosis-service" tabindex="-1"><a class="header-anchor" href="#start-osmosis-service" aria-hidden="true">#</a> Start Osmosis Service</h2><p>Reload and start the service:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">sudo systemctl daemon-reload</span></span>\n<span class="line"><span style="color:#ADBAC7;">sudo systemctl start cosmovisor</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Check the status of your service:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">sudo systemctl status cosmovisor</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>To see live logs of your service:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#22272e;"><code><span class="line"><span style="color:#ADBAC7;">journalctl -u cosmovisor -f</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>The process should initialize and get to block 1122200, where it will automatically upgrade to v4.0.0-rc1</p><p>At around block height 1128853, when reading the logs you will see many notifications of &quot;slashing and jailing validator&quot;. This is due to fact that many validators did not participate in the testnet and therefore get jailed at the same time (approx 30,000 blocks after the upgrade). In my experience, this may cause your node to reset due to a memory error. As long as you set up the service above, it will automatically reset and eventually get passed this difficult block.</p><p>Guide as of 17 November 2021.</p>',53),l={},o=(0,a(3744).Z)(l,[["render",function(s,n){return e}]])}}]);